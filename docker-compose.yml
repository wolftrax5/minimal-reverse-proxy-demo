version: "3"

services:
  # Proxies requests to internal services
  reverse-proxy:
    image: nginx:1.17.10
    container_name: reverse_proxy_demo1
    depends_on:
      - weather-report1
      - temperature-service1
      - precip-service1
      - angular-app1
    volumes:
      - ./reverse_proxy/nginx.conf:/etc/nginx/nginx.conf
    ports:
      - 80:80

  # generates weather reports
  weather-report:
    image: weather-report
    container_name: weather-report1
    build:
      context: ./weather_report
    depends_on:
      - temperature-service
      - precip-service
    ports:
      - 8080:80
    restart: on-failure

  # Retrieves the temperature
  temperature-service:
    image: temperature-service
    container_name: temperature-service1
    build:
      context: ./temperature_service
    ports:
      - 5001:5001
    restart: on-failure

  # Retrieves the menu Json
  menu-service:
    image: menu-service
    container_name: menu-service1
    build:
      context: ./menu_service
    ports:
      - 8081:8081
    restart: on-failure

  # Generates a precipitation estimate
  precip-service:
    image: precip-service
    container_name: precip-service1
    build:
      context: ./precip_service
    ports:
      - 5002:5002
    restart: on-failure

  # angular app
  angular-app:
    image: wolftrax/poc-config-tokens:latest
    container_name: angular-app1
    ports:
      - 5003:80
    restart: on-failure
    environment:
      - SYNIVERSE_ENVIRONMENT=docker-env
      - MPM_BASE_URL=/mobile-profile-management/
      - MPM_MENU_LOCATION=/menu-service/menu
      - MPM_DOSSIER_EMBEDDING_LIB_URL=https://symphony-dev.dalab.syniverse.com/ubinalib/javascript/embeddinglib.js
      - MPM_PROFILE_SUMMARY_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/DF5E84C3A041CF0FBC504E96522E0EF6
      - MPM_USAGE_STATISTICS_IMSI_COUNT_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/C6F56338634D0F977B8061B95772A60E
      - MPM_USAGE_STATISTICS_SDR_CHARGE_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/8AD979C916494D64B5442FA7617E74A3
      - MPM_OPERATOR_STATISTICS_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/BD0ED03C8C409FD50C8045ABDEDD34A0
      - MPM_APN_STATISTICS_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/2AB3CA32F644BD0638263DB9EB7C1424
      - MPM_DEVICE_STATISTICS_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/9E8D16C7EF4D9528DB965D839E36C7A5
      - MPM_DETAILED_REPORT_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/7A19121A2E4322D6F3F59584A7F452F1
      - MPM_IMSI_LOOKUP_URL=https://da3d-gen-mst-tcs001.dalab.syniverse.com:8444/MicroStrategyLibrary/app/0293B65611EBCECE98320080EFC50108/50540543441FC059C79D04B45D824E02
